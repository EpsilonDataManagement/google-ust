___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Epsilon Site Tag",
  "categories": ["CONVERSIONS", "MARKETING", "ATTRIBUTION"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAnIAAAJxCAIAAABJ2MhsAAAACXBIWXMAAC4jAAAuIwF4pT92AAAZpUlEQVR4nO3d23Ua26Ku0bl2O+/IEYAjAEdAKQLjCEARGEUgFIFQBEIRGEUgFIEhAqEIDBHM05prL283e07bKn4uBb0/+MkSFxV8dRk1xn/+/vvvvwCAhP/xLgJAiqwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQIysAkCMrAJAjKwCQMz/81ZSX7PZ7OfnXhSFPylbtVqt5vP5z49wdnbW6XS89ydOVqmN+Xw+m83m8/lyuXx6evr1026322dnZ0VRdDqdoijOzs78oamm3OrKDW8+n6/X69/+mm63WybW5neC/vP333/v91XP5/PVanWY73zrq20/ynK5nEwm8V/b6XS+/zDX9xhuMpnMZrPpdPonX2f/pt1uF0UxGAz2ezAxGo1e9f+Lr7b2dP7XPx70/8JuPhf7tVwup1/9dgfuTzSbzV6vVxRFr9c7wBc7+2qT3zAcDre06zCZTJbL5Z///8FgsP+N8+9963a7e34L/t3V1dUO3p3Hx8edvaJ2u/3+/furq6tPnz59+fJl73/9X3h+fv748WOj0ci+A81m8+bmZl+v/bXPdjdb4GE+q7348uXLzc1Nu91+7XvyhxqNRr/f//z580G96qurqw1f1/Y2idcG4vHxcUvP5M8ZsnRaFovFw8PD9fX1hw8f3rx50+l0hsPhq3YGd2C5XA4Gg7dv397e3m5yhPqPXl5eLi8vW63WaDQ62NMk7F651b158+by8nKxWGzp8dfr9f39/bt374qi2MY5qn25vr4+tK+RPZLVk7ZYLG5vb9++fXs4H/LxeNzpdO7v77f6KOv1+vr6utVqHdNXG9V8243b9lb3vaenp4uLi1arNZ1Oj+PvNhgMDuBZHARZ5a9vH/JOp7PhJZZNrFaroiguLy/jR6j/Zr1eX1xcFEVhR/s0rVar0Wi046B+7+Xl5cOHD0VR/OO44np5enra47fHQZFV/s9isTg/Px8Oh7s/Ozqfz1utVmR4yGs9PT05G3yCZrNZp9O5vr7e+0t/enp69+7da4ezHSAHrCVZ5Ue3t7dFUeyyNPP5vCiKnR2k/uDq6sq9hqdmNBqdn5+/vLwczuu+vr7udDq1PnHy8vJyBDsHm5NV/sFiseh0Orsp636b2mw2fRGclPJawyEcpP6s/NzV+oTweDx2SUVW+WcvLy87OGYtv+P21dTyrrh9PTS7V25ve7nW8IfW6/W7d+/qu1mu12v7qbLKv1osFtu+WNLr9fbY1I8fP5rp8HTM5/NOp7O9m2eCLi4u6lvW+/v7Ex+7JKv8ysPDw3g83tJbNB6P93jc4PTvSVmtVr1e76Aupv5arcs6HA4P4FnsjazyG1uaNqG8t2GPb/5kMjFT64koz/3WqKmli4uLmh72LRaL7e2OHz5Z5TfW6/U2PiHD4dDpX3ZjMBjU4tzvz3q9Xk1HMJ3yLGayyu+Nx+PsJ2S1Wu3rBnynf0/NaDR6eHio6Yter9eDwaCOfTrlsUsWhqulctWzXz/z5XKZOuu1Xq+n02lw+NLmF43a7Xav1ytX6SmPO5dflYvHzWazXxwKO/17OubzefZemnIppFarVd7r/O2cR7n5leuwzmaz4KCBxWIxGo3qeE719vZ272tG7cfeJ/u3gk2FFWz+fJWG5+fnu7u7fr+/4VIw79+/D77kTVYI6ff7z8/Pv32IT58+9fv9bb+Q13rti7WCzYZSa9GUCx/9yYb3zb9tgdVsdWGWzVew+TfdbnfD51bHFWzql9XN/06HZqtZ/ebLly+bfHgajUbqbXt+fq72HNrt9qu+135+1Y1GY7/L4b32JcvqJiK16Ha7m3xTPz8/R+LabDYP/I36N3d3d5s8NwvDcbjOzs5Go9Hnz5+rHbau1+vU5CnVhmC02+3ZbPbaBYrLV/38/Pz+/Xunf0/KarXa8MRpo9G4u7ubzWabjG4rV0l6fn7e8LTcy8tLTcfWnuDYJVk9LeUaNdXKut+sTqfTykUsl996fn7u9XrVfgO1s+FQ8263Wy4YF3ndrVZrNptteFBY0z7Vd4egMlk9OZ1Op9oIvdQtdBWy2u/3X3uc+rPNfwN1sVwuNxlq3u/3Z7NZ/MTGaDT69OlT5VEOW7rVbQdObZFzWT1Fw+FwwxFMm6iwx+0eU15lk6Hm/X5/e9Mb9Xq9yqeLaj2F9UmtGSerJ6peo94daPIqlY/qttrUUqfTqfwQLy8vNS3rSS1yLqsnql7Hf5aa4s9NJpNqV1Xb7fZuzrL2er3K11kPIavVjrZP54BVVqmBWq9AyY5Np9NqD7jLgeKj0aja2OCnp6e972UOBoNms/nanzqdRc5l9UTV6/hvMpmc7PyivMpqtao2VeHV1dWOr4xUPu6svN+QcnZ2Vu2w/kQWOZfVE1Wv47/1en3iS03xh6pdwGs0GrvfwFqtVrWZIg7hImWv16twtH0iEwXL6ilaLpd7XNCj2vij+/v7Xq/nmJVfq3YkNxwO9zJPSLXGHMjKAdWOtk9hkXNZPUXVTuCkhuNW/j0PDw/lnDWRp8FRqnYaZl/nQmp9wNpqtT5+/FjhB4/+zJOsnpzZbHZ7e1vhVaeyuskg5PV6fXFxUcbVkSs/WK1WFU7D9Pv9PU5pWW3mrwO5iDMajSqMCl4sFse9c1y/heGWy+VWz863Wq0jHgg+m80qT+CXGtBRFEWj0dhkYrmXl5eLi4vhcNj7r8gTo+6qxWa/20+v16vwcTiQrJZjly4uLl77g+WH91gn6K5fVl9eXrILKP6g2+0eZVbL3ZHKM7o1m83gZ6DX622+jPl6vb7/qtFolHUtisJM+qesjlmt9nE4nPG0g8FgMpm8dn3ZcuzSsc4V7CTwMVutVrPZbDwe93q9t2/fblKy7FdP9nxD2dcPHz68efOm1+udyCB+flbhusAhrPdc4bJIcJn0zVX7ON/e3h7r/eiyWkvn5+f/+QNv3rw5Pz+/vLzcfOhgNquVBzv81sPDw+Xl5du3b1ut1nA4NI/ESanw5z6EWTzrNZPoz4qiqDbw6ljHLskqv9dsNuOTHY5GowoTtfy5l5eX29vbd+/ebTIFK/VS4Wi1vlk9qF3G8XhcYezS09PT3qe22AZZ5fe2MUbs7OxsOp3uYCGdxWJxcXFRrme+7ceidg5kFYcKu5gHNRK+8udrOBwe35B+WeU3ms3mlsZwbbKm+mut1+vr6+tyPfMdPBx7Ud9r6kewRtNwOGy326/9qaNc5FxW+Y2tbvS7LGv5Gf7w4YN5EI/Vy8vLa19Z3a9rHpRq3xXHt8i5rPIr/X5/27cfdDqd+XxeYT+3stvb206nY7Qw5dlLb0NKURTv37+v8MuObE9XVvlXO1t+stVqzefzLY0N/keLxaLM+c4eEU5BtbFLDw8PxzRRsKzyz9rt9mw22+W+/Hg8fnx83Orw4O+t1+uiKByznjgbQFZ5Y1uFX3lMk/DIKv+g2+3uuKmlsnN3d3e7iet6vbYqzjGpcClBVuOq3Tt3TIucyyo/urq62ktTvxkMBsvl8vHxsdp1mldZLBZuvDka9b1QemTXIyovcn4c+7iyyv/pdrvPz88HkpmiKKbT6ZcvX+7u7rba1yOeRI3fOpBLehVWnjjkMcyVFzk/jrFLsspf5Yjfx8fH2Wx2aPfPnZ2dDQaDb33t9/vbuBvHAetxqLD1HsJJ4GppP/BD81Ne5Lx+K9g0Go2t7qadzn1sjUajKIpy7ZfDP3tW9rUc1zD9r01Wl/vew8PDcrk8glvyT1yFv+AhnKio8Bx2NrKvslardXV1VWG1sSOYyrt+WS0nEDiAJ1IzzWaz1WqdnZ11/qu+FSl3Bcq+TiaTzRcSKH+VaSLqrsI+8WKx2PseVYUvtFp8eIfD4Xg8fu2+b7nIea0HBjsJXEuPj49/v9JyuZzNZtPpdDQa9Xq94zgy6/V60+n0+fn56upqw5PD9tWOQLWter9/+tVqVWG/sBYn1cpFziv8YN0nCpZVaq/Vao1Go+VyucmEErJ6BKrFZr8LHFWbpLou16oGg0G1sUu1Hu4gqxyJcte48oQSqcu07FeFL/Gnp6c9DlyqFvX4Qo3bU+2A9fb2tr63FMsqR6UoisozDDtgPQLVerOvY6PZbPb09PTanyrHSWznGeV1Op1qi5zX9/KqrHJszs7OrFt+sqqtDHF/f7+XY6NqOa/RoWrp1BY5l1WOUOUdZOqu0+lUG7y2+2Oj6XRa4VC18q7DHp3aIueyynGq3R49KdWq8/T0tMv1tFerVbWQNxqN2mV1k0XOF4vFdp7RFskqx8ncDier8v3Ho9FoZxMR9Hq9aqPk6tjU0i73WvZLVoGj0ul0qo1Z29mKRoPBoNrp31qv+F0UxYlcmpFVjlOFw476rn/CDyq35+XlpSiKrZZ1MBjc399X+9lut1vr2VVHo9E25vQ+NLLKQZhMJtmbHCoMBj6d6aCP3mAwqDxr7mKx6HQ62zgbXF5PrdzUI1gTovIi5/Uiq+zfcrkcDofX19epCZ/H4/FrRzoc/tzlvMomBSqPWbPXAufzeVEUmzS12+0ewUC8aouc14ussn+DwaAcvrFYLM7Pz4ui2CSuk8nk8vLytT/lUPXIbHLAWl5nvby8LIpi8/tZV6vVaDR69+7dhoNaj2b5wqO/rbx+K9isVqudzYbT+mo3j3WyxuPxD8M3np6ezs/Pu93ut5Xg/lD5/XV7e1vhvXRDzp8rl23Yxm/OfuImk8n5+fkmv+Hp6ent27f9fn84HFbY8VqtVuOvNp8as9/vH80mWhRFt9utPGirBl67EEpchTk8d+bq6moH78Dj4+NrX1CFFWwO05cvX349hKHRaPT7/bu7u+fn51+8gk+fPm24wvmvf3/Ka5/VbrbAym9aXPz1Boeettvtm5ubz58///ZByyX3379/n3roRqPx5cuX7Dvzvaurq1c9n83/TM/Pz6k35weH8N1Yv6NVjsm307//Zr1e33/1bQX7csnY8r+Xx0yb7/Z2u12nJY7SeDyezWYvLy+bv7jFYvHt4kK5wfywzaxWq/l8vlwuIw/3vclkcmTD1Csvcl4LssreTKfTV600uV6vy4JG1i3/Xq3XTOYXzs7OptPpu3fvsm/S01e7eeP7/X59p4D4heFwOJlM4rsgh8CQJfaj8uRtcc1mU1aPWKfTubu7q+nra7fbxzrAp/JEwYdPVtmP357+3ZnTmVPtZA0GgzrO79Nut497scJqi5wfPlllD157+nd7ut3uUZ5h4weTyaReZW00Gsd3SfVnR7lTK6vs2uGc/m00GjVd0JEKalTWZrM5m81O4V7qTqfz8ePHA3giSbLKro1GowM5/TudTs0DfFImk8nhf4m32+35fH4685Mc30TBsspOzWazatM1xN3d3ZkC4gSNx+O7u7uD/R5///79bDY7qb29s7OzIzsVLKvsVKfTOYRBCnd3d0b/nqzBYDCbzaotHrdVNzc3p3kGZTAYHOCfozJZZafOzs5ms9lrZ3UJajQanz590tQTVy7qcDgnhLvd7ufPn09hdZd/c0wHrLLKHoxGo8fHx93vn5ZXrQz95du5x8+fP+/39Emj0bi7uzuRAUq/cEyLnMsq+1EUxXw+v7m52c1VrkajcXNzM5/PTVLI98rD1sfHx93HtdFoXF1dLZdL505K4/H4OMYuySr7NBwOl8vl1dXV9j5O3768TvkMG79WrkX4+PgYnB//F5rN5t3d3XK5HI1GxqJ/c3Z2dhwfUlllz8o5zFarVXbRj/KUry8v/lxRFNPp9Pn5+ebmZhtXKJrNZr/f//z5c3mEapv82XEscv6fg1oWClar1XQ6nX1VYRruRqNRfNXr9ZzvZRPlsrKVN8VSuexSuUFaKv9EyCqHq1xpaz6fr1ar5Vf/+FTL20+LorDsPFvy/aZY/ls+zrd1bJrN5rdtr1y+0AZ5smQVAGJcWwWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgBhZBYAYWQWAGFkFgIy//vrr/wOp8RAETK9CUAAAAABJRU5ErkJggg\u003d\u003d"
  },
  "description": "Epsilon is a global advertising and marketing tech company, and part of Publicis Groupe. We connect advertisers with people to drive performance while keeping consumer privacy at the forefront.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "GROUP",
    "name": "tagDetails",
    "displayName": "Tag Details",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "GROUP",
        "name": "siteDetails",
        "displayName": "Site Details",
        "groupStyle": "ZIPPY_OPEN",
        "subParams": [
          {
            "type": "TEXT",
            "name": "host",
            "displayName": "Domain",
            "simpleValueType": true,
            "help": "The hostname the advertiser is using for the tag. Ex. tag.brandco.com",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          },
          {
            "type": "TEXT",
            "name": "tagPath",
            "displayName": "Reverse Proxy Directory Path",
            "simpleValueType": true,
            "help": "The directory path of the Reverse Proxy. If you are not using a Reverse Proxy integration, leave this field blank.  If you are using a Reverse Proxy, enter the path of the Reverse Proxy (typically /tag_path or the custom path you have setup as the root of your Reverse Proxy)."
          }
        ]
      },
      {
        "type": "GROUP",
        "name": "companyDetails",
        "displayName": "Company Details",
        "subParams": [
          {
            "type": "TEXT",
            "name": "dtm_cid",
            "displayName": "Company ID (dtm_cid)",
            "simpleValueType": true,
            "help": "Advertiser identifier.",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              },
              {
                "type": "POSITIVE_NUMBER"
              }
            ]
          },
          {
            "type": "TEXT",
            "name": "dtm_cmagic",
            "displayName": "Company Magic (dtm_cmagic)",
            "simpleValueType": true,
            "help": "Secondary advertiser identifier.",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ],
        "groupStyle": "ZIPPY_OPEN"
      },
      {
        "type": "GROUP",
        "name": "dynamicFields",
        "displayName": "Dynamic Fields",
        "groupStyle": "ZIPPY_OPEN",
        "subParams": [
          {
            "type": "TEXT",
            "name": "dtm_fid",
            "displayName": "Form ID (dtm_fid)",
            "simpleValueType": true,
            "help": "Form identifier. Ex. 101",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              },
              {
                "type": "POSITIVE_NUMBER"
              }
            ]
          },
          {
            "type": "TEXT",
            "name": "dtm_promo_id",
            "displayName": "Promo ID (dtm_promo_id)",
            "simpleValueType": true,
            "help": "Value that identifies the page type."
          },
          {
            "type": "TEXT",
            "name": "dtm_email_hash",
            "displayName": "Email Hash (dtm_email_hash)",
            "simpleValueType": true,
            "help": "SHA-256 hash of customer’s email address. *Remove leading/trailing spaces and convert email address to lowercase before hashing."
          },
          {
            "type": "TEXT",
            "name": "dtm_user_id",
            "displayName": "User ID (dtm_user_id)",
            "simpleValueType": true,
            "help": "Unique identifier."
          },
          {
            "type": "TEXT",
            "name": "dtmc_tcf_string",
            "displayName": "Consent String",
            "simpleValueType": true,
            "help": "GDPR consent string."
          },
          {
            "type": "TEXT",
            "name": "customParameters",
            "displayName": "Custom Parameters",
            "simpleValueType": true,
            "enablingConditions": [],
            "help": "Additional custom parameters to be added if advised by Epsilon to be added at the end of the query string. Ex. custom_key1\u003dvalue1\u0026custom_key2\u003dvalue2"
          }
        ]
      },
      {
        "type": "GROUP",
        "name": "advancedProperties",
        "displayName": "Advanced Properties",
        "groupStyle": "ZIPPY_CLOSED",
        "subParams": [
          {
            "type": "RADIO",
            "name": "enableAdvanced",
            "displayName": "Enable Advanced Properties",
            "radioItems": [
              {
                "value": 0,
                "displayValue": "Disabled"
              },
              {
                "value": 1,
                "displayValue": "Enabled"
              }
            ],
            "simpleValueType": true,
            "defaultValue": 0
          },
          {
            "type": "RADIO",
            "name": "integrationType",
            "displayName": "Integration Type",
            "radioItems": [
              {
                "value": 0,
                "displayValue": "Default"
              },
              {
                "value": 1,
                "displayValue": "Limited"
              }
            ],
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "enableAdvanced",
                "paramValue": 1,
                "type": "EQUALS"
              }
            ],
            "defaultValue": 0,
            "help": "Limited integrations should only be used if specified by Epsilon."
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "pageVisitProperties",
    "displayName": "Page Visit Properties",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "dtmc_department",
        "displayName": "Department (dtmc_department)",
        "simpleValueType": true,
        "help": "The department name for the current page. (Men, Women, Children, etc.)"
      },
      {
        "type": "TEXT",
        "name": "dtmc_category",
        "displayName": "Category (dtmc_category)",
        "simpleValueType": true,
        "help": "The category name for the current page. (Clothing, Accessories, etc.)"
      },
      {
        "type": "TEXT",
        "name": "dtmc_sub_category",
        "displayName": "Subcategory (dtmc_sub_category)",
        "simpleValueType": true,
        "help": "The subcategory name for the current page. (Sweaters, Tops, Bottoms, etc.)"
      },
      {
        "type": "TEXT",
        "name": "dtmc_brand",
        "displayName": "Brand (dtmc_brand)",
        "simpleValueType": true,
        "help": "Manufacturer brand."
      },
      {
        "type": "TEXT",
        "name": "dtmc_product_id",
        "displayName": "Product ID (dtmc_product_id)",
        "simpleValueType": true,
        "help": "Product ID for current product."
      },
      {
        "type": "TEXT",
        "name": "dtmc_upc",
        "displayName": "UPC (dtmc_upc)",
        "simpleValueType": true,
        "help": "Manufacturer UPC code."
      },
      {
        "type": "TEXT",
        "name": "dtmc_mpn",
        "displayName": "Model Part Number (dtmc_mpn)",
        "simpleValueType": true,
        "help": "Manufacturer Model Part Number."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "conversionProperties",
    "displayName": "Conversion Properties",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "dtmc_transaction_id",
        "displayName": "Transaction ID (dtmc_transaction_id)",
        "simpleValueType": true,
        "help": "Client system\u0027s unique identifier for each conversion."
      },
      {
        "type": "TEXT",
        "name": "dtm_conv_val",
        "displayName": "Conversion Value (dtm_conv_val)",
        "simpleValueType": true,
        "help": "Conversion value."
      },
      {
        "type": "TEXT",
        "name": "dtm_conv_curr",
        "displayName": "Conversion Currency (dtm_conv_curr)",
        "simpleValueType": true,
        "help": "ISO currency code (EUR, USD)."
      },
      {
        "type": "TEXT",
        "name": "dtmc_conv_type",
        "displayName": "Conversion Type (dtmc_conv_type)",
        "simpleValueType": true,
        "help": "Differentiate between types of Online Purchases: Delivery, Pickup, etc."
      },
      {
        "type": "TEXT",
        "name": "dtmc_conv_store_location",
        "displayName": "Conversion Store Location (dtmc_conv_store_location)",
        "simpleValueType": true,
        "help": "For Pickup type conversions, denote the store location of the pickup."
      },
      {
        "type": "TEXT",
        "name": "dtm_items",
        "displayName": "Items (dtm_items)",
        "simpleValueType": true,
        "help": "An array of all items in the conversion. Each item should include the following: product_id: SKU of the item;",
        "textAsList": false
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const injectScript = require('injectScript');
const sendPixel = require('sendPixel');
const Object = require('Object');
const JSON = require('JSON');
const getCookieValues = require('getCookieValues');
const encodeUriComponent = require('encodeUriComponent');
const getContainerVersion = require('getContainerVersion');
const queryPermission = require('queryPermission');
const getTimestampMillis = require('getTimestampMillis');
const getUrl = require('getUrl');

// Declare Variables
let baseURL = 'https://' + data.host;
const allowedQueryParameters = ['dtm_cid', 'dtm_cmagic', 'dtm_fid', 'dtm_promo_id', 'dtm_email_hash', 'dtm_user_id', 'dtmc_department', 'dtmc_category', 'dtmc_sub_category', 'dtmc_product_id', 'dtmc_brand', 'dtmc_upc', 'dtmc_mpn', 'dtmc_transaction_id', 'dtm_conv_val', 'dtm_conv_curr', 'dtmc_conv_type', 'dtmc_conv_store_location', 'dtm_items', 'dtmc_tcf_string'];

const cv = getContainerVersion();
const cachebusterValue = cv.containerId + '-' + cv.version + '-' + getTimestampMillis();
const pageUrl = getUrl();
let queryStringParameters;
let dtmToken;
let dtmTokenSC;
let finalURL;

log('data = ', data);

//Checking Integration Type RP or Anycast
const integrationType = function(tagPath) {
  
  //True = RP; False = Anycast
  if (tagPath === undefined) {
    return false;
  } else {
    return true;
  }
};

//Assign URL based on Integration Type
if (integrationType(data.tagPath)) {
  baseURL += data.tagPath;
}

//Assigning query string parameters
Object.entries(data).forEach(dataEntries => {
    if (allowedQueryParameters.indexOf(dataEntries[0]) >= 0 && dataEntries[1]) {
      if (dataEntries[0] === 'dtm_items') {
        dataEntries[1] = JSON.stringify(dataEntries[1]).replace();
      }
      
      if (queryStringParameters  === undefined) {
          queryStringParameters = '?' + dataEntries[0] + '=' + encodeUriComponent(dataEntries[1]);
      } else {
          queryStringParameters += '&' + dataEntries[0] + '=' + encodeUriComponent(dataEntries[1]);
      }
    }
});

//Populating Cookie Parameters
dtmToken = getCookieValues('dtm_token');
dtmTokenSC = getCookieValues('dtm_token_sc');

log('dtm_token: ', dtmToken);
log('dtm_token_sc: ', dtmTokenSC);

if (dtmToken.length > 0) {
  queryStringParameters += '&dtm_token=' + dtmToken[0];
} else if (dtmTokenSC.length > 0) {
  queryStringParameters += '&dtm_token=' + dtmTokenSC[0];
}

if (dtmTokenSC.length > 0) {
  queryStringParameters += '&dtm_token_sc=' + dtmTokenSC[0];
}

// dtmc_loc
queryStringParameters += '&dtmc_loc=' + encodeUriComponent(pageUrl);

//Populating dtmc_tms query parameter
queryStringParameters += '&dtmc_tms=4';

//Populating Cachebuster query parameter
queryStringParameters += '&cachebuster=' + cachebusterValue;

//Populating Additional query parameters
if (data.customParameters) {
  queryStringParameters += '&' + data.customParameters;
}

log('queryParameters = ', queryStringParameters);

const onSuccess = function() {
  log('Script loaded successfully: ' + baseURL);
  data.gtmOnSuccess();
};
const onFailure = function() {
  log('Script load failed: ' + baseURL);
  data.gtmOnFailure();
};

//Launch Tag
if (data.integrationType === 0 || !data.integrationType) {
  if (queryPermission('inject_script', baseURL)) {
    //Javascript Tag
    finalURL = baseURL + '/profile/visit/js/1_0' + queryStringParameters;
    injectScript(finalURL, onSuccess, onFailure);
  } else {
    log('Invalid permission to load script from: ', baseURL);
    data.gtmOnFailure();
  }
} else {
  //Pixel Tag
  finalURL = baseURL + '/profile/visit/px/1_0' + queryStringParameters;
  sendPixel(finalURL, onSuccess, onFailure);
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.dotomi.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 11/29/2022, 2:32:00 PM


